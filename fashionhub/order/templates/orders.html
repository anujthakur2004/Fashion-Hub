{% extends "base.html" %}
{% load static %}
{% load tz %}

{% block title %}
<title>My Orders | Fashion Hub</title>
{% endblock title %}

{% block content %}
<style>
  .orders-wrapper { background:#fff; border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,0.08); padding:1.5rem; }
  .order-card { border:1px solid #e9ecef; border-radius:12px; padding:1rem 1.25rem; margin-bottom:1rem; }
  .badge-paid { background:#e6f4ea; color:#198754; border:1px solid #c8e6d0; }
  .badge-unpaid { background:#fff5f5; color:#dc3545; border:1px solid #f5c2c7; }
  .item-row { display:flex; justify-content:space-between; padding:0.5rem 0; border-bottom:1px dashed #e9ecef; align-items:center; }
  .item-row:last-child { border-bottom:0; }
  .order-header { display:flex; justify-content:space-between; align-items:center; }
  .product-img { width:50px; height:50px; object-fit:cover; border-radius:8px; margin-right:0.75rem; }
  .item-details { display:flex; align-items:center; flex:1; }
  .muted { color:#6c757d; }
  .btn-view { font-size:0.875rem; padding:0.4rem 1rem; }
</style>

<div class="container my-5">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="mb-0">My Orders</h3>
  </div>

  {% if orders %}
  <div class="orders-wrapper">
    {% for order in orders %}
    <div class="order-card">
      <div class="order-header">
        <div>
          <div class="fw-semibold">Order #{{ order.id }}</div>
          <div class="muted small">Placed: {% localtime on %}{{ order.created_at|date:"M d, Y h:i A" }}{% endlocaltime %}</div>
        </div>
        <span class="badge rounded-pill {% if order.is_paid %}badge-paid{% else %}badge-unpaid{% endif %}">
          {% if order.is_paid %}PAID{% else %}COD / UNPAID{% endif %}
        </span>
      </div>

      <div class="mt-3">
        {% for item in order.items.all %}
        <div class="item-row">
          <div class="item-details">
            {% if item.product and item.product.images.first %}
              <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product_name }}" class="product-img">
            {% else %}
              <div class="product-img bg-light d-flex align-items-center justify-content-center">
                <i class="bi bi-image text-muted"></i>
              </div>
            {% endif %}
            <div>
              <div class="fw-semibold">{{ item.product_name }}</div>
              <div class="muted small">{% if item.size %}Size: {{ item.size|upper }} · {% endif %}Qty: {{ item.quantity }}</div>
            </div>
          </div>
          <div class="fw-semibold">₹{{ item.line_total }}</div>
        </div>
        {% empty %}
        <div class="muted small">No items recorded for this order.</div>
        {% endfor %}
      </div>

      <div class="d-flex justify-content-between align-items-center pt-2 mt-2 border-top">
        <span class="fw-semibold">Total</span>
        <span class="fw-bold text-primary">₹{{ order.total_amount }}</span>
      </div>

      <div class="mt-2">
        <a href="{% url 'order_detail' order.id %}" class="btn btn-sm btn-outline-primary w-100">
          <i class="bi bi-eye me-1"></i> View Details
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center p-5 bg-white rounded-3 shadow-sm">
    <i class="bi bi-bag-x" style="font-size:3rem;color:#ced4da;"></i>
    <h5 class="mt-3">You don't have any orders yet</h5>
    <p class="muted">Browse products and place your first order.</p>
    <a href="{% url 'home' %}" class="btn btn-primary"><i class="bi bi-bag me-1"></i> Start Shopping</a>
  </div>
  {% endif %}
</div>
{% endblock content %}
