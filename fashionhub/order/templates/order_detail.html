{% extends "base.html" %}
{% load static %}
{% load tz %}

{% block title %}
<title>Order #{{ order.id }} | Fashion Hub</title>
{% endblock title %}

{% block content %}
<style>
  .detail-wrapper { background:#fff; border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,0.08); padding:2rem; }
  .detail-header { border-bottom:2px solid #e9ecef; padding-bottom:1rem; margin-bottom:1.5rem; }
  .badge-paid { background:#e6f4ea; color:#198754; border:1px solid #c8e6d0; }
  .badge-unpaid { background:#fff5f5; color:#dc3545; border:1px solid #f5c2c7; }
  .item-row { display:flex; align-items:center; padding:0.8rem 0; border-bottom:1px dashed #e9ecef; }
  .item-row:last-child { border-bottom:0; }
  .product-img { width:70px; height:70px; object-fit:cover; border-radius:8px; margin-right:1rem; }
  .item-details { flex:1; }
  .info-section { background:#f8f9fa; border-radius:12px; padding:1.2rem; margin-bottom:1rem; }
  .info-label { font-weight:600; color:#495057; }
</style>

<div class="container my-5">
  <div class="detail-wrapper">
    <div class="detail-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h3 class="mb-1">Order #{{ order.id }}</h3>
          <div class="text-muted">Placed on {% localtime on %}{{ order.created_at|date:"M d, Y h:i A" }}{% endlocaltime %}</div>
        </div>
        <span class="badge rounded-pill {% if order.is_paid %}badge-paid{% else %}badge-unpaid{% endif %}">
          {% if order.is_paid %}PAID{% else %}COD / UNPAID{% endif %}
        </span>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-8">
        <h5 class="mb-3">Order Items</h5>
        {% for item in items %}
        <div class="item-row">
          {% if item.product and item.product.images.first %}
            <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product_name }}" class="product-img">
          {% else %}
            <div class="product-img bg-light d-flex align-items-center justify-content-center">
              <i class="bi bi-image text-muted"></i>
            </div>
          {% endif %}
          <div class="item-details">
            <div class="fw-semibold">{{ item.product_name }}</div>
            <div class="text-muted small">
              {% if item.size %}Size: {{ item.size|upper }} · {% endif %}
              Qty: {{ item.quantity }} × ₹{{ item.unit_price }}
            </div>
          </div>
          <div class="fw-semibold">₹{{ item.line_total }}</div>
        </div>
        {% empty %}
        <div class="text-muted">No items recorded for this order.</div>
        {% endfor %}

        <div class="d-flex justify-content-between align-items-center pt-3 mt-3 border-top">
          <span class="fw-bold">Total Amount</span>
          <span class="fw-bold text-primary fs-5">₹{{ order.total_amount }}</span>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="info-section">
          <h6 class="info-label mb-2">Order Information</h6>
          <div class="small">
            <div class="mb-2">
              <strong>Order ID:</strong> {{ order.id }}
            </div>
            <div class="mb-2">
              <strong>Status:</strong>
              {% if order.is_paid %}
                <span class="text-success">Paid</span>
              {% else %}
                <span class="text-danger">Cash on Delivery</span>
              {% endif %}
            </div>
            <div class="mb-2">
              <strong>Created:</strong> {% localtime on %}{{ order.created_at|date:"M d, Y h:i A" }}{% endlocaltime %}
            </div>
            <div>
              <strong>Last Updated:</strong> {% localtime on %}{{ order.updated_at|date:"M d, Y h:i A" }}{% endlocaltime %}
            </div>
          </div>
        </div>

        <a href="{% url 'orders' %}" class="btn btn-outline-secondary w-100">
          <i class="bi bi-arrow-left me-2"></i>Back to Orders
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
